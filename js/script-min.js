function processTrack(e){if(1==e.resultCount){var t=e.results[0];if("USA"!==t.country){var r=t.trackViewUrl,a=(t.trackName+" "+t.artistName).toLowerCase().replace(/[^a-z0-9\s]/gi,"").replace(/\s+/gi,"-");createCookie(a+"-"+country,r,14);var c=document.getElementById("link-"+a);c.href=r}}}function processGeolocation(e){e&&(country=e.country.toLowerCase(),updateUrls(country))}function easeInOut(e,t,r,a){return e/=a/2,1>e?r/2*e*e+t:(e-=1,-r/2*(e*(e-2)-1)+t)}function scrollTo(e,t,r){var a=e.scrollTop,c=t-a,o=20,s=function(t){t+=o;var l=easeInOut(t,a,c,r);e.scrollTop=l,r>t&&setTimeout(function(){s(t)},o)};s(0)}var stylesheet=document.createElement("link");stylesheet.href="/css/top.css",stylesheet.rel="stylesheet",stylesheet.type="text/css",stylesheet.media="all",document.getElementsByTagName("head")[0].appendChild(stylesheet);var listing=document.getElementById("listing"),tracks=document.querySelectorAll(".show-track"),selectedArtwork=document.getElementById("selected-artwork"),selectedTrack=document.getElementById("selected-track-link"),selectedLink=document.getElementById("selected-link"),createCookie=function(e,t,r){var a="";if(r){var c=new Date;c.setTime(c.getTime()+24*r*60*60*1e3),a="; expires="+c.toGMTString()}document.cookie=e+"="+t+a+"; path=/"},readCookie=function(e){for(var t=e+"=",r=document.cookie.split(";"),a=0;a<r.length;a++){for(var c=r[a];" "===c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(t))return c.substring(t.length,c.length)}return null},updateUrls=function(e){if(createCookie("country",e,30),"us"!==e)for(var t=listing.querySelectorAll("a.preview"),r="undefined"==typeof Storage,a=t.length-1;a>=0;a--){var c=t[a].getAttribute("data-target-id");if(url=readCookie(c+"-"+e))createCookie(c+"-"+e,url,14),t[a].href=url;else{var o=encodeURIComponent(t[a].getAttribute("data-artist")+" "+t[a].getAttribute("data-track"));loadScript("http://itunes.apple.com/search?term="+o+"&media=music&entity=song&limit=1&callback=processTrack&country="+e)}}},selectTrack=function(e){var t=e.getAttribute("data-src");selectedArtwork.src=t,selectedArtwork.className="",e.className+=" selected",selectedArtwork.alt=selectedTrack.title=selectedLink.title=selectedTrack.textContent=e.title,selectedTrack.href=selectedLink.href=e.getElementsByTagName("a")[0].href;for(var r=artworkSizes[artworkSizes.length-1],a=0;a<artworkSizes.length;a++)if(selectedArtwork.offsetWidth<=artworkSizes[a]){r=artworkSizes[a];break}var c=new Image;c.onload=function(){selectedArtwork.src=c.src,selectedArtwork.className="loaded"},c.src=t.replace("100x100",r+"x"+r),listing.scrollTop&&scrollTo(listing,0,500)},clickTrack=function(e){"TR"!==this.tagName&&e.preventDefault(),body.className="listing-open";var t=listing.querySelector("tr.selected");t&&(t.className=t.className.replace(" selected",""));var r=this.getAttribute("data-target-id");window.location.hash=r;var a=document.getElementById("track-"+r);a&&selectTrack(a)};if(window.location.hash.length>1){var target=document.getElementById("track-"+window.location.hash.substring(1));target&&(body.className="listing-open",selectTrack(target))}document.getElementById("close").addEventListener("click",function(){body.className=""},!1);for(var i=tracks.length-1;i>=0;i--)tracks[i].addEventListener("click",clickTrack,!0);var country=readCookie("country");country?updateUrls(country):loadScript("http://ipinfo.io/?callback=processGeolocation");